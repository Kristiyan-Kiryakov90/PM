<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; connect-src 'self' https://zuupemhuaovzqqhyyocz.supabase.co wss://zuupemhuaovzqqhyyocz.supabase.co; img-src 'self' data: blob: https://zuupemhuaovzqqhyyocz.supabase.co; font-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self';">
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <title>Reports & Analytics - TaskFlow</title>
  <link rel="stylesheet" href="../src/styles/global/global.css">
  <link rel="stylesheet" href="../src/styles/shared/navbar.css">
  <link rel="stylesheet" href="../src/styles/shared/notifications.css">
  <link rel="stylesheet" href="../src/features/reports/styles/reports.css">
  <!-- Inline critical CSS: reserves layout space to prevent CLS -->
  <style>
    body { margin: 0; }
    .reports-main { min-height: 100vh; }
    .reports-container { max-width: 1400px; margin: 0 auto; padding: 2rem 1rem; }
    .report-section { background: white; border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0,0,0,.1); contain: layout; }
    .report-content-placeholder { min-height: 120px; }
    .metrics-grid { min-height: 120px; }
  </style>
</head>
<body>
  <!-- Navigation (injected by navbar component) -->

  <!-- Main Content -->
  <main class="reports-main">
      <div class="reports-container">
        <!-- Header -->
        <div class="reports-header">
          <h1>ðŸ“Š Reports & Analytics</h1>
          <p>Track team performance, task completion, and time metrics</p>
        </div>

        <!-- Filters Section -->
        <div class="reports-filters">
          <h3>Filters</h3>
          <div class="filter-row">
            <div class="filter-group">
              <label for="filterProject">Project</label>
              <select class="form-select" id="filterProject">
                <option value="">All Projects</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="filterUser">Team Member</label>
              <select class="form-select" id="filterUser">
                <option value="">All Members</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="filterStartDate">Start Date</label>
              <input type="date" class="form-control" id="filterStartDate">
            </div>
            <div class="filter-group">
              <label for="filterEndDate">End Date</label>
              <input type="date" class="form-control" id="filterEndDate">
            </div>
          </div>

          <!-- Date Range Presets -->
          <div class="filter-presets">
            <button class="filter-preset-btn" data-preset="today">Today</button>
            <button class="filter-preset-btn" data-preset="last7Days">Last 7 Days</button>
            <button class="filter-preset-btn active" data-preset="last30Days">Last 30 Days</button>
            <button class="filter-preset-btn" data-preset="thisMonth">This Month</button>
            <button class="filter-preset-btn" data-preset="lastMonth">Last Month</button>
            <button class="filter-preset-btn" data-preset="thisYear">This Year</button>
            <button class="filter-preset-btn" data-preset="all">All Time</button>
          </div>
        </div>

        <!-- Metrics Overview -->
        <div class="metrics-grid" id="metricsGrid" style="min-height: 120px;">
          <!-- Metrics will be rendered here -->
        </div>

        <!-- Task Completion Report -->
        <div class="report-section">
          <div class="report-section-header">
            <h2 class="report-section-title">Task Completion</h2>
          </div>
          <div id="taskCompletionContent" class="report-content-placeholder">
            <div class="report-skeleton" aria-hidden="true">
              <div class="report-skeleton-bar wide"></div>
              <div class="report-skeleton-row wide"></div>
              <div class="report-skeleton-row medium"></div>
              <div class="report-skeleton-row narrow"></div>
            </div>
          </div>
        </div>

        <!-- Status Distribution Report -->
        <div class="report-section">
          <div class="report-section-header">
            <h2 class="report-section-title">Status Distribution</h2>
          </div>
          <div id="statusDistributionContent" class="report-content-placeholder">
            <div class="report-skeleton" aria-hidden="true">
              <div class="report-skeleton-bar wide"></div>
              <div class="report-skeleton-row medium"></div>
              <div class="report-skeleton-row narrow"></div>
            </div>
          </div>
        </div>

        <!-- Priority Distribution Report -->
        <div class="report-section">
          <div class="report-section-header">
            <h2 class="report-section-title">Priority Breakdown</h2>
          </div>
          <div id="priorityDistributionContent" class="report-content-placeholder">
            <div class="report-skeleton" aria-hidden="true">
              <div class="report-skeleton-bar wide"></div>
              <div class="report-skeleton-row medium"></div>
              <div class="report-skeleton-row narrow"></div>
            </div>
          </div>
        </div>

        <!-- Team Productivity (Company users only) -->
        <div class="report-section" id="teamProductivitySection" style="display: none;">
          <div class="report-section-header">
            <h2 class="report-section-title">Team Productivity</h2>
          </div>
          <div id="teamProductivityContent" class="report-content-placeholder">
            <div class="report-skeleton" aria-hidden="true">
              <div class="report-skeleton-bar wide"></div>
              <div class="report-skeleton-row medium"></div>
              <div class="report-skeleton-row narrow"></div>
            </div>
          </div>
        </div>

        <!-- Overdue Tasks Report -->
        <div class="report-section">
          <div class="report-section-header">
            <h2 class="report-section-title">Overdue Tasks</h2>
          </div>
          <div id="overdueTasksContent" class="report-content-placeholder">
            <div class="report-skeleton" aria-hidden="true">
              <div class="report-skeleton-bar wide"></div>
              <div class="report-skeleton-row medium"></div>
              <div class="report-skeleton-row narrow"></div>
            </div>
          </div>
        </div>

        <!-- Export Button -->
        <div class="export-pdf-container">
          <button class="btn btn-primary btn-lg" id="exportPdfBtn">
            <span>ðŸ“„</span> Export Full Report as PDF
          </button>
        </div>
      </div>
    </main>

  <!-- jsPDF library for direct PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script type="module" src="../src/features/reports/pages/reports.js"></script>
</body>
</html>
